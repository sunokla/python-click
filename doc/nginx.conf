#/etc/nginx/.nginx.conf.swp# For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

#user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;


# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.
#include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    #tcp_nopush          on;
    #tcp_nodelay         on;
    keepalive_timeout   300;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;

    proxy_hide_header X-Powered-By;


    ##缓存cache参数配置##  
    proxy_connect_timeout 5;  
    proxy_read_timeout 60;  
    proxy_send_timeout 5;  
    proxy_buffer_size 16k;  
    proxy_buffers 4 64k;  
    proxy_busy_buffers_size 128k;  
    proxy_temp_file_write_size 128k; 

    #缓存到nginx的本地目录  
    #proxy_temp_path  /usr/nuzar/nginx/temp;  
    #proxy_cache_path /usr/nuzar/nginx/cache_temp levels=1:2 keys_zone=cache_one:200m inactive=1d max_size=30g;  
    ##end##  

    #压缩配置#  
    gzip  on;           #打开gzip压缩功能  
    gzip_min_length 1k; #压缩阈值  
    gzip_buffers 4 16k; #buffer 不用修改  
    gzip_comp_level 9;  #压缩级别:1-10，数字越大压缩的越好，时间也越长  
    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png application/vnd.ms-fontobject font/ttf font/opentype font/x-woff;
    gzip_vary on;      #跟Squid等缓存服务有关，on的话会在Header里增加 "Vary: Accept-Encoding"  
    gzip_disable "MSIE [1-6]\.";  #IE1-6版本不支持gzip压缩 
     
     
      #upstream loolwsd {
      #	 zone loolwsd 64k;
      #	 hash $arg_WOPISrc;

      #	 server localhost:9980;
      #}

     #server {
      #	listen 80;
  
     	#server_name online.yeahteamsstg.com;

     	#location / {
     	 #proxy_pass                 http://loolwsd;
     	 #proxy_set_header           Host $host;
     	 #proxy_http_version         1.1;
     	 #proxy_set_header           Upgrade $http_upgrade;
     	 #proxy_set_header           Connection "upgrade";
     	 #client_max_body_size       0;
     	#}
     #}     
     
     server {
        listen      443 ssl;
 	server_name  online.yeahteams.com;

        ssl_certificate /etc/nginx/5710431__yeahteams.com.pem;
        ssl_certificate_key /etc/nginx/5710431__yeahteams.com.key; 
        
        # static files
    	location ^~ /loleaflet {
        	proxy_pass http://localhost:9980;
        	proxy_set_header Host $http_host;
   	 }	

    	# WOPI discovery URL
    	location ^~ /hosting/discovery {
        	proxy_pass http://localhost:9980;
        	proxy_set_header Host $http_host;
    	}

    	# Capabilities
    	location ^~ /hosting/capabilities {
        	proxy_pass http://localhost:9980;
        	proxy_set_header Host $http_host;
    	}

    	# main websocket
    	location ~ ^/lool/(.*)/ws$ {
        	proxy_pass http://localhost:9980;
        	proxy_set_header Upgrade $http_upgrade;
        	proxy_set_header Connection "Upgrade";
        	proxy_set_header Host $http_host;
        	proxy_read_timeout 36000s;
    	}

    	# download, presentation and image upload
    	location ~ ^/lool {
        	proxy_pass http://localhost:9980;
        	proxy_set_header Host $http_host;
    	}

    	# Admin Console websocket
    	location ^~ /lool/adminws {
        	proxy_pass http://localhost:9980;
        	proxy_set_header Upgrade $http_upgrade;
        	proxy_set_header Connection "Upgrade";
        	proxy_set_header Host $http_host;
        	proxy_read_timeout 36000s;
    	}


     }     


  
}
